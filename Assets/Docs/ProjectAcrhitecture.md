# Project Architecture

## Общая информация
1. Точкой входа являются контроллеры каждой сцены
- FirstScene - заглушка-фикс бага со крашем из за рендеринга
- InitScene - запуск основных систем (сейвы, конфиги)
- MainScene - игровая сцена со всеми игровыми контроллерами и т.д.
2. Мы стараемся не использовать Unity callback. Используем callback от VContainer через интерфейсы и контроллеры
3. Используем DDD с некоторыми допущениями
4. Репозиторий на дженериках и общий для всех доменов (по сути просто сервис сохранений)
5. Достаточно много логики в слое приложения, нужно потихоньку переносить часть в домен
6. Пока не прокидываем домен в домен, есть сложности в DI и проектированием
7. Создаем оболочки для доменов в виде контроллеров в слое приложения
8. Позволяем использовать классы Domain во Presentation уровне, однако только для вывода данных
9. Используем как реактивный подход, так и транзакционный из-за специфики UI и эффектов
10. Используем Presenter-Model для связи UI и домена
11. Специфическая система сохранений (каждый домен независим)
12. Полный отказ от синглтонов
13. Для всех классов делаем явные конструкторы (даже для конструкторов по умолчанию) и помечаем их Preserve атрибутом

##DDD в нашем проекте

###Структурные части DDD
1. Entity (Сущность):
Сущности представляют объекты, обладающие уникальной идентичностью в предметной области. Это могут быть объекты, которые имеют жизненный цикл и изменяют свое состояние. Сущности определяются идентификатором, а не своими атрибутами.
2. Value Object (Объект-значение):
Объекты-значения представляют собой нечто, определенное только своими характеристиками (значениями). Они обычно не имеют уникальной идентичности и представляют собой неизменяемые объекты, используемые для описания значений.
3. Aggregate (Агрегат):
Агрегаты представляют собой группы связанных сущностей и объектов-значений, которые образуют логическую единицу. У каждого агрегата есть корень, через который происходит взаимодействие с остальными элементами внутри агрегата. Агрегаты служат границей для транзакций и согласованности данных.
4. Repository (Репозиторий):
Репозитории представляют собой механизмы для сохранения и извлечения агрегатов и сущностей из хранилищ данных. Они обеспечивают абстракцию доступа к данным и скрывают детали взаимодействия с хранилищем данных от остальной части приложения.
5. Factory (Фабрика):
Фабрики используются для создания сложных объектов, таких как агрегаты или сущности, и управления процессом их создания. Фабрики помогают соблюдать инварианты и обеспечивают гибкость в создании объектов.
6. Service (Сервис):
Сервисы предоставляют дополнительную бизнес-логику, которая не подходит под определение сущности или агрегата. Они могут выполнять операции, касающиеся нескольких агрегатов, или предоставлять функциональность, которая не имеет отношения к конкретному объекту.

###Слои проекта DDD
1. Presentation Layer:Этот слой занимается отображением данных, обработкой пользовательского ввода и взаимодействием с пользователем. Он не должен зависеть напрямую от более низких уровней.
2. Application Layer:Этот слой является оркестратором, координирующим работу слоя предметной области и слоев инфраструктуры. Он зависит от слоя предметной области, чтобы применять бизнес-правила, и от слоев инфраструктуры, чтобы вызывать операции ввода/вывода. Содержит управляющие и служебные классы.
3. Domain Layer:Этот слой содержит бизнес-логику и предметную область. Он является самым важным и стабильным слоем и не должен зависеть от других слоев. Все зависимости должны быть направлены внутрь слоя.
4. Repositories Layer:Этот слой содержит интерфейсы и реализации репозиториев, отвечающих за доступ к данным. Репозитории предоставляют интерфейс для взаимодействия с хранилищем данных и реализуют операции чтения и записи. Они зависят от слоя предметной области.
5. Infrastructure Layer:Этот слой включает в себя всю инфраструктуру, такую как базы данных, файловые системы, сетевые операции и т. д.

###Направления зависимостей
- От Application к Presentation: Application Layer зависит от Presentation Layer для подписки на пользовательский ввод и передачи данных через Presentation Model объект.
- От Application к Domain: Application Layer зависит от Domain Layer для применения бизнес-правил и выполнения операций с предметной областью.
- От Application к Repositories: Application Layer зависит от Repositories Layer для доступа к данным и сохранения/загрузки состояния.
- От Repositories к Domain: Repositories Layer зависит от Domain Layer, поскольку операции чтения/записи связаны с бизнес-сущностями. Однако в нашей реализации мы решили упросить слой репозитория и сделали репозиторий как сервис сохранений/загрузки.
- Все могут зависеть от Infrastructure, Infrastructure не зависит ни от кого (включая Presentation слой)

Вот несколько примеров логики, которую помещаем в Application Layer:
- Оркестрация бизнес-процессов:Комбинирование нескольких шагов в более крупные операции или процессы. Например, запуск новой игры, загрузка уровня, сбор тайлов и т. д.
- Координация сервисов предметной области:Вызов методов сервисов предметной области для выполнения бизнес-операций. Например, вызов метода для сбора тайлов или проверки условий победы.
- Управление транзакциями:Координирование операций, которые должны быть выполнены как атомарные транзакции. Например, сохранение изменений в нескольких репозиториях в рамках одной операции.
- Распределение ответственности:Разделение бизнес-логики между разными сервисами предметной области и вызов нужных сервисов в нужное время.
- Управление состоянием:Отслеживание состояния приложения и реакция на события, например, обработка завершения игры или достижения определенного условия.
- Авторизация и аутентификация:Реализация проверок безопасности и принятие решений относительно доступа к определенным функциональностям приложения.
- Инициализация зависимостей:Инициализация и конфигурация зависимостей для других компонентов приложения, таких как визуализация или обработка пользовательского ввода.

##Немного теории
- DDD 
https://romanglushach.medium.com/domain-driven-design-ddd-a-guide-to-building-scalable-high-performance-systems-5314a7fe053c
- Presentation-Model 
https://www.martinfowler.com/eaaDev/PresentationModel.html